<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <meta name="description" content="Quarkus Dev UI">

  <title>Dev UI</title>

  <link rel="icon" type="image/x-icon" href="favicon.ico">
  <link rel="stylesheet" href="https://unpkg.com/@vonage/vivid@next/styles/fonts/spezia.css">
  <link rel="stylesheet" href="https://unpkg.com/@vonage/vivid@next/styles/themes/light.css" data-type="theme"
    media="all">
  <link rel="stylesheet" href="https://unpkg.com/@vonage/vivid@next/styles/themes/dark.css" data-type="theme"
    media="not all" disabled="">
  
  <style>
    #top::part(base) {
      position: fixed;
      top: 0;
      left:0;
      z-index: 2;
    }

    vwc-side-drawer::part(base) {
      block-size: calc(100vh - var(--_header-block-size));
      bottom: 0;
      top: auto;
      left:0px;
    }

    vwc-side-drawer>main { 
      padding-block-start: var(--_header-block-size);
    }
    
    #drawerCloseIcon {
      position: fixed;
      bottom: 40px;
    }

    #bottomClose::part(base){
      position: fixed;
      bottom: 0;
      left:0px;
      z-index: 2;
      height: 32px;
    }
    
    #bottomOpen::part(base){
      height: 32px;
      cursor: row-resize;
    }

    .mainAppContent {
      padding-bottom: 16px;  
    }
    .openBottomAppContent {
      padding-bottom: 32px;
      position: fixed;
      bottom: 0;
      left:0px;
      z-index: 2;
      padding-bottom: 32px;
      display: none;
      width: 100%;
    }

  </style>

  <style id="bottomCloseStyleOverride"></style>

</head>

<body>
  <vwc-layout gutters="none" column-basis="block">

    <vwc-header id="top" elevation-shadow>

      <img id="logo" src="./img/light_icon.svg" alt="Quarkus icon" height="40px" style="vertical-align: middle;">    
      <h3>Dev UI</h3>

      <vwc-button id="drawerOpenIcon" appearance='ghost' icon='menu-line' style="display: none;" title="Open the navigation menu"></vwc-button>
      
      <h2 slot="action-items"><qwc-version-info></qwc-version-info></h2>
      <vwc-button class="mainHeaderIcon" slot="action-items" icon="twitter-mono" href="https://twitter.com/QuarkusIO"></vwc-button>
      <vwc-button class="mainHeaderIcon" slot="action-items" icon="github-mono" href="https://github.com/quarkusio/quarkus"></vwc-button>
      <vwc-button id="dayNightSwitch" slot="action-items" icon="dark-mode-solid"></vwc-button>
      
      <vwc-side-drawer id="mainSideDrawer" open slot="app-content">
      
        <vwc-layout gutters="small-block" column-basis="block">
          <vwc-nav>
            <vwc-nav-item class="mainTabItem" text="Extensions" icon="puzzle-solid" data-page="extensionsPage" aria-current="page"></vwc-nav-item>
            <vwc-nav-item class="mainTabItem" text="Configuration" icon="preferences-solid" data-page="configurationPage"></vwc-nav-item>
            <vwc-nav-item class="mainTabItem" text="Continuous Testing" icon="check-all-solid" data-page="continuousTestingPage"></vwc-nav-item>
            <vwc-nav-item class="mainTabItem" text="Dev services" icon="wand-solid" data-page="devServicesPage"></vwc-nav-item>
            <vwc-nav-item class="mainTabItem" text="Build steps" icon="wrench-tool-solid" data-page="buildStepsPage"></vwc-nav-item>
            <vwc-nav-item id="drawerCloseIcon" icon="chevron-left-solid" title="Close the navigation menu"></vwc-nav-item>
          </vwc-nav>
        </vwc-layout>

        <main slot="app-content" class="mainAppContent">
          <vwc-layout id="extensionsPage" class="mainTabPage" gutters="none" column-basis="block" column-spacing="small">
            <qwc-extensions elevation="24" active></qwc-extensions>
            <vwc-divider></vwc-divider>
            <qwc-extensions elevation="2"></qwc-extensions>
          </vwc-layout>

          <vwc-layout id="configurationPage" style="display:none;" class="mainTabPage" gutters="none" column-basis="block" column-spacing="small">
            <qwc-configuration></qwc-configuration>
          </vwc-layout>

          <vwc-layout id="continuousTestingPage" style="display:none;" class="mainTabPage">
            <qwc-continuous-testing></qwc-continuous-testing>
          </vwc-layout>
          
          <vwc-layout id="devServicesPage" style="display:none;" class="mainTabPage">
            <qwc-dev-services></qwc-dev-services>
          </vwc-layout>
          
          <vwc-layout id="buildStepsPage" style="display:none;" class="mainTabPage">
            <qwc-build-steps></qwc-build-steps>
          </vwc-layout>
        </main>
      </vwc-side-drawer>
    </vwc-header>
  
    <vwc-header id="bottomClose" elevation-shadow>
      <vwc-button id="openBottomButton" icon="chevron-up-solid" label='Open' slot="action-items" appearance='ghost' density='condensed'></vwc-button>      
      <main slot="app-content" class="openBottomAppContent">
        <vwc-layout gutters="none" column-basis="block">
          <vwc-header id="bottomOpen" elevation-shadow>
            <vwc-button id="closeBottomButton" icon="chevron-down-solid" label='Close' slot="action-items" appearance='ghost' density='condensed'></vwc-button>
            <main slot="app-content">
              <qwc-bottom-drawer></qwc-bottom-drawer>
            </main>
          </vwc-header>
        </vwc-layout>
      </main>
    </vwc-header>
  </vwc-layout>
  
  <script type="module" src="https://unpkg.com/@vonage/vivid@3.0.0-next.47/index.js"></script>
  
  <script type="module" src="./qwc/qwc-version-info.js"></script>
  <script type="module" src="./qwc/qwc-extensions.js"></script>
  <script type="module" src="./qwc/qwc-configuration.js"></script>
  <script type="module" src="./qwc/qwc-continuous-testing.js"></script>
  <script type="module" src="./qwc/qwc-dev-services.js"></script>
  <script type="module" src="./qwc/qwc-build-steps.js"></script>
  <script type="module" src="./qwc/qwc-bottom-drawer.js"></script>
  <script>
    
    restoreStateFromLocalStorage();
    addListeners();

    function addListeners() {

      // Header icons
      const headerIcons = document.querySelectorAll('[class="mainHeaderIcon"]');
      headerIcons.forEach((headerIcon) => {
        headerIcon.addEventListener("click", function () {
          var url = headerIcon.getAttribute("href");
          navigateOut(url);
        });
      });

      // Day night switch
      const dayNightSwitch = document.getElementById('dayNightSwitch');
      dayNightSwitch.addEventListener("click", flipLightSwitch);

      // Tabs / pages menu items
      const tabItems = document.querySelectorAll('[class="mainTabItem"]');
      tabItems.forEach((tabItem) => {
        tabItem.addEventListener("click", function () {
          showPage(tabItem.dataset.page);
        });
      });

      // Tabs drawer open/close
      const drawerCloseIcon = document.getElementById('drawerCloseIcon');
      drawerCloseIcon.addEventListener("click", closeTabMenuDrawer);
      const drawerOpenIcon = document.getElementById('drawerOpenIcon');
      drawerOpenIcon.addEventListener("click", openTabMenuDrawer);

      const openBottomButton = document.getElementById('openBottomButton');
      openBottomButton.addEventListener("click", openBottom);
      const closeBottomButton = document.getElementById('closeBottomButton');
      closeBottomButton.addEventListener("click", closeBottom);
      
      // Log file drawer
      const bottomOpen = document.getElementById('bottomOpen');
      bottomOpen.addEventListener("mousedown", function(e){
          m_pos = e.y;
          document.addEventListener("mousemove", resizeMainBottomDrawer, false);   
      }, false);

      document.addEventListener("mouseup", function(){
          document.removeEventListener("mousemove", resizeMainBottomDrawer, false);
          saveMainBottomDrawerHeight();
      }, false);
    }

    function restoreStateFromLocalStorage() {
      const storedDayNightMode = localStorage.getItem('dayNightMode');
      if (storedDayNightMode && storedDayNightMode === "dark") {
        flipLightSwitch();
      }

      openCloseTabDrawer();

      const storedBottomState = localStorage.getItem('bottomState');
      if (storedBottomState && storedBottomState === "open") {
        openBottom();
      }

    }

    function resizeMainBottomDrawer(e){
      const dx = m_pos - e.y;
      m_pos = e.y;

      const drawerCloseIcon = document.getElementById('drawerCloseIcon');
      const openBottomAppContents = document.querySelectorAll('[class="openBottomAppContent"]');
      openBottomAppContents.forEach((openBottomAppContent) => {
        if(openBottomAppContent.style.height !== "unset"){
          let height = parseInt(getComputedStyle(openBottomAppContent, '').height) + dx;
          if(height<50){
            document.removeEventListener("mousemove", resizeMainBottomDrawer, false);
            closeBottom();
          }else{
            height = "" + height;
            if(!height.endsWith("vh") && !height.endsWith("px")){
              height = height + "px";
            }
            resizeBottom(height);
          }
        }
      });
    }

    function saveMainBottomDrawerHeight(){
      
      const openBottomAppContents = document.querySelectorAll('[class="openBottomAppContent"]');
      openBottomAppContents.forEach((openBottomAppContent) => {
        const currentDisplay = window.getComputedStyle(openBottomAppContent).display;
        if(currentDisplay !== "none"){
          const currentHeight = window.getComputedStyle(openBottomAppContent).height;
          localStorage.setItem('openBottomAppContentHeight', currentHeight);
        }
      });
    }

    function showPage(pageName) {
      const currentNavItem = document.querySelector('vwc-nav-item[aria-current="page"]');
      currentNavItem?.removeAttribute('aria-current');
      event.currentTarget.setAttribute('aria-current', 'page');


      const pages = document.querySelectorAll('[class="mainTabPage"]');
      pages.forEach((page) => {
         page.style.display = "none";
      });
      const pageToShow = document.getElementById(pageName);
      pageToShow.removeAttribute("style");
    }

    function navigateOut(url) {
      window.open(url, '_blank').focus();
    }

    function flipLightSwitch() {

      const themes = document.querySelectorAll('[rel="stylesheet"][data-type="theme"]');
      themes.forEach((theme) => {
        var disabled = theme.getAttribute("disabled");
        if (disabled || disabled === "") {
          theme.removeAttribute("disabled");
          theme.setAttribute("media", "all");
        } else {
          theme.setAttribute("disabled", "");
          theme.setAttribute("media", "not all");
        }
      });

      const dayNightSwitch = document.getElementById("dayNightSwitch");
      var currentIcon = dayNightSwitch.getAttribute("icon");
      const logo = document.getElementById('logo');
      if (currentIcon === "light-mode-solid") {
        dayNightSwitch.setAttribute("icon", "dark-mode-solid");
        localStorage.setItem('dayNightMode', "light");
        logo.setAttribute("src", "./img/light_icon.svg");
      } else {
        dayNightSwitch.setAttribute("icon", "light-mode-solid");
        localStorage.setItem('dayNightMode', "dark");
        logo.setAttribute("src", "./img/dark_icon.svg");
      }
    }

    function closeTabMenuDrawer(){
      const mainSideDrawer = document.getElementById('mainSideDrawer');
      const drawerOpenIcon = document.getElementById('drawerOpenIcon');
      mainSideDrawer.removeAttribute("open");
      drawerOpenIcon.removeAttribute("style");
      localStorage.setItem("mainNavState", "hide");  
    }

    function openTabMenuDrawer(){
      const mainSideDrawer = document.getElementById('mainSideDrawer');
      const drawerOpenIcon = document.getElementById('drawerOpenIcon');
      mainSideDrawer.setAttribute("open","");
      drawerOpenIcon.style.display = "none";
      localStorage.removeItem("mainNavState");
    }

    function openCloseTabDrawer(){
      const storedMainNavState = localStorage.getItem('mainNavState');
      if(storedMainNavState && storedMainNavState==="hide"){
        closeTabMenuDrawer();
      }else{
        openTabMenuDrawer();
      }
    }

    function openBottom(){

      // Hide the closed bar
      const bottomCloseStyleOverride = document.getElementById('bottomCloseStyleOverride');
      bottomCloseStyleOverride.innerText = `
                                        #bottomClose::part(base){
                                          height: 0px;
                                        }`;
      
      let height = "300px";
      const storedHeight = localStorage.getItem('openBottomAppContentHeight');
      if(storedHeight){
        height = storedHeight;
      }

      resizeBottom(height);
      
      localStorage.setItem('bottomState', 'open');
    }

    function resizeBottom(height){
      const openBottomAppContent = document.querySelectorAll('[class="openBottomAppContent"]');
      openBottomAppContent.forEach((openBottomAppContent) => {
        openBottomAppContent.style.display = "unset";
        openBottomAppContent.style.height = height;
      });

      const mainAppContents = document.querySelectorAll('[class="mainAppContent"]');
      mainAppContents.forEach((mainAppContent) => {
        let mainAppContentPadding = (parseInt(height.replace(/px/,""))+16)+"px";
        mainAppContent.style.paddingBottom = mainAppContentPadding;
      });

      let drawerCloseIconPosition = (parseInt(height.replace(/px/,""))+40)+"px";
      const drawerCloseIcon = document.getElementById('drawerCloseIcon');
      drawerCloseIcon.style.bottom = drawerCloseIconPosition;
    }

    function closeBottom(){
      const mainAppContents = document.querySelectorAll('[class="mainAppContent"]');
      mainAppContents.forEach((mainAppContent) => {
        mainAppContent.style.paddingBottom = "16px";
      });

      const openBottomAppContent = document.querySelectorAll('[class="openBottomAppContent"]');
      openBottomAppContent.forEach((openBottomAppContent) => {
        openBottomAppContent.style.display = "none";
      });

      const drawerCloseIcon = document.getElementById('drawerCloseIcon');
      drawerCloseIcon.style.bottom = "40px";

      const bottomCloseStyleOverride = document.getElementById('bottomCloseStyleOverride');
      bottomCloseStyleOverride.innerText = "";

      localStorage.removeItem('bottomState');
    }

  </script>

</body>

</html>